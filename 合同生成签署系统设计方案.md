# åˆåŒç”Ÿæˆç­¾ç½²ç³»ç»Ÿè®¾è®¡æ–¹æ¡ˆ

## ğŸ¯ ç³»ç»Ÿæ¦‚è¿°

è®¾è®¡ä¸€ä¸ªå®‰å…¨å¯é ã€æˆæœ¬ä½çš„åˆåŒç”Ÿæˆå’Œç”µå­ç­¾ç½²ç³»ç»Ÿï¼Œæ”¯æŒç”¨æˆ·ä»˜è´¹åè‡ªåŠ¨ç”ŸæˆåˆåŒã€å‘é€ç»™å®¢æˆ·ç­¾ç½²ã€ç”ŸæˆPDFä¸‹è½½ç­‰åŠŸèƒ½ã€‚

## ğŸ“‹ åŠŸèƒ½éœ€æ±‚åˆ†æ

### æ ¸å¿ƒåŠŸèƒ½
1. **åˆåŒæ¨¡æ¿ç®¡ç†**ï¼šæ”¯æŒå¤šç§åˆåŒæ¨¡æ¿ï¼ˆä¼šå‘˜æœåŠ¡åˆåŒã€ä¸€æ¬¡æ€§æœåŠ¡åˆåŒç­‰ï¼‰
2. **åˆåŒç”Ÿæˆ**ï¼šæ ¹æ®ç”¨æˆ·ä¿¡æ¯å’Œä»˜è´¹æƒ…å†µè‡ªåŠ¨ç”ŸæˆåˆåŒ
3. **ç”µå­ç­¾ç½²**ï¼šæ”¯æŒå®¢æˆ·åœ¨çº¿ç­¾ç½²åˆåŒ
4. **PDFç”Ÿæˆ**ï¼šå°†ç­¾ç½²åçš„åˆåŒç”ŸæˆPDFæ–‡ä»¶
5. **åˆåŒç®¡ç†**ï¼šåˆåŒçŠ¶æ€è·Ÿè¸ªã€å†å²è®°å½•ç­‰
6. **å®‰å…¨éªŒè¯**ï¼šç¡®ä¿åˆåŒçœŸå®æ€§å’Œä¸å¯ç¯¡æ”¹æ€§

### ä¸šåŠ¡æµç¨‹
```
ç”¨æˆ·ä»˜è´¹ â†’ ç”ŸæˆåˆåŒ â†’ å‘é€ç­¾ç½²é“¾æ¥ â†’ å®¢æˆ·ç­¾ç½² â†’ ç”ŸæˆPDF â†’ å­˜å‚¨å½’æ¡£
```

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„è®¾è®¡

### 1. åˆåŒæ¨¡æ¿ç³»ç»Ÿ

**æ–¹æ¡ˆé€‰æ‹©**ï¼šåŸºäºHTMLæ¨¡æ¿ + å˜é‡æ›¿æ¢
- **ä¼˜åŠ¿**ï¼šæˆæœ¬ä½ã€çµæ´»æ€§å¼ºã€æ˜“äºç»´æŠ¤
- **å®ç°**ï¼šä½¿ç”¨Handlebars.jsæˆ–ç±»ä¼¼æ¨¡æ¿å¼•æ“

**æ¨¡æ¿ç»“æ„**ï¼š
```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>{{contractTitle}}</title>
    <style>
        /* åˆåŒæ ·å¼ */
        .contract-header { text-align: center; margin-bottom: 30px; }
        .contract-content { line-height: 1.6; margin: 20px 0; }
        .signature-section { margin-top: 50px; }
        .signature-line { border-bottom: 1px solid #000; width: 200px; display: inline-block; }
    </style>
</head>
<body>
    <div class="contract-header">
        <h1>{{contractTitle}}</h1>
        <p>åˆåŒç¼–å·ï¼š{{contractNumber}}</p>
        <p>ç­¾ç½²æ—¥æœŸï¼š{{signDate}}</p>
    </div>
    
    <div class="contract-content">
        <!-- åˆåŒå†…å®¹ -->
        <p>ç”²æ–¹ï¼š{{companyName}}</p>
        <p>ä¹™æ–¹ï¼š{{customerName}}</p>
        <!-- æ›´å¤šåˆåŒæ¡æ¬¾... -->
    </div>
    
    <div class="signature-section">
        <p>ç”²æ–¹ç­¾å­—ï¼š<span class="signature-line"></span></p>
        <p>ä¹™æ–¹ç­¾å­—ï¼š<span class="signature-line"></span></p>
    </div>
</body>
</html>
```

### 2. ç”µå­ç­¾åæ–¹æ¡ˆ

**æ–¹æ¡ˆé€‰æ‹©**ï¼šCanvasæ‰‹å†™ç­¾å + æ•°å­—è¯ä¹¦éªŒè¯
- **æˆæœ¬**ï¼šå‡ ä¹ä¸ºé›¶ï¼ˆä½¿ç”¨å¼€æºåº“ï¼‰
- **å®‰å…¨æ€§**ï¼šé€šè¿‡æ•°å­—è¯ä¹¦å’Œå“ˆå¸ŒéªŒè¯ç¡®ä¿çœŸå®æ€§

**å®ç°æ­¥éª¤**ï¼š
1. ä½¿ç”¨Canvas APIè®©ç”¨æˆ·æ‰‹å†™ç­¾å
2. å°†ç­¾åè½¬æ¢ä¸ºBase64å›¾ç‰‡
3. ç”Ÿæˆç­¾åå“ˆå¸Œå€¼
4. ä½¿ç”¨æ—¶é—´æˆ³å’Œéšæœºæ•°ç¡®ä¿å”¯ä¸€æ€§

**ç­¾åéªŒè¯**ï¼š
```javascript
// ç”Ÿæˆç­¾åå“ˆå¸Œ
function generateSignatureHash(signatureData, timestamp, nonce) {
    const data = signatureData + timestamp + nonce;
    return crypto.createHash('sha256').update(data).digest('hex');
}

// éªŒè¯ç­¾å
function verifySignature(signatureData, timestamp, nonce, hash) {
    const expectedHash = generateSignatureHash(signatureData, timestamp, nonce);
    return expectedHash === hash;
}
```

### 3. PDFç”Ÿæˆæ–¹æ¡ˆ

**æ–¹æ¡ˆé€‰æ‹©**ï¼šPuppeteer + HTMLè½¬PDF
- **æˆæœ¬**ï¼šæœåŠ¡å™¨èµ„æºï¼ˆçº¦$5-10/æœˆï¼‰
- **ä¼˜åŠ¿**ï¼šé«˜è´¨é‡PDFã€æ”¯æŒå¤æ‚å¸ƒå±€ã€æˆæœ¬ä½

**å®ç°**ï¼š
```javascript
const puppeteer = require('puppeteer');

async function generatePDF(htmlContent, options = {}) {
    const browser = await puppeteer.launch({
        headless: true,
        args: ['--no-sandbox', '--disable-setuid-sandbox']
    });
    
    const page = await browser.newPage();
    await page.setContent(htmlContent);
    
    const pdf = await page.pdf({
        format: 'A4',
        printBackground: true,
        margin: {
            top: '20mm',
            right: '20mm',
            bottom: '20mm',
            left: '20mm'
        },
        ...options
    });
    
    await browser.close();
    return pdf;
}
```

### 4. æ•°æ®åº“è®¾è®¡

**åˆåŒè¡¨ (contracts)**ï¼š
```sql
CREATE TABLE contracts (
    id BIGINT PRIMARY KEY,
    contract_number VARCHAR(50) UNIQUE NOT NULL,
    member_id BIGINT NOT NULL,
    contract_type ENUM('MEMBERSHIP', 'ONE_TIME', 'ANNUAL') NOT NULL,
    template_id BIGINT NOT NULL,
    status ENUM('DRAFT', 'PENDING', 'SIGNED', 'EXPIRED', 'CANCELLED') DEFAULT 'DRAFT',
    content TEXT NOT NULL,
    variables JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    signed_at TIMESTAMP NULL,
    expires_at TIMESTAMP NULL,
    pdf_url VARCHAR(500),
    signature_data JSON,
    signature_hash VARCHAR(64),
    FOREIGN KEY (member_id) REFERENCES members(id)
);
```

**åˆåŒæ¨¡æ¿è¡¨ (contract_templates)**ï¼š
```sql
CREATE TABLE contract_templates (
    id BIGINT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    type ENUM('MEMBERSHIP', 'ONE_TIME', 'ANNUAL') NOT NULL,
    template_content TEXT NOT NULL,
    variables_schema JSON,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

**åˆåŒç­¾ç½²è®°å½•è¡¨ (contract_signatures)**ï¼š
```sql
CREATE TABLE contract_signatures (
    id BIGINT PRIMARY KEY,
    contract_id BIGINT NOT NULL,
    signer_type ENUM('CUSTOMER', 'COMPANY') NOT NULL,
    signature_data TEXT NOT NULL,
    signature_hash VARCHAR(64) NOT NULL,
    signed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ip_address VARCHAR(45),
    user_agent TEXT,
    FOREIGN KEY (contract_id) REFERENCES contracts(id)
);
```

### 5. APIæ¥å£è®¾è®¡

**åˆåŒç”ŸæˆAPI**ï¼š
```typescript
// POST /api/contracts/generate
interface GenerateContractRequest {
    memberId: number;
    contractType: 'MEMBERSHIP' | 'ONE_TIME' | 'ANNUAL';
    templateId?: number;
    variables?: Record<string, any>;
}

interface GenerateContractResponse {
    contractId: number;
    contractNumber: string;
    signUrl: string;
    expiresAt: string;
}
```

**åˆåŒç­¾ç½²API**ï¼š
```typescript
// POST /api/contracts/{contractId}/sign
interface SignContractRequest {
    signatureData: string; // Base64ç­¾åå›¾ç‰‡
    signerType: 'CUSTOMER' | 'COMPANY';
}

interface SignContractResponse {
    success: boolean;
    pdfUrl?: string;
    message: string;
}
```

**PDFä¸‹è½½API**ï¼š
```typescript
// GET /api/contracts/{contractId}/pdf
// è¿”å›PDFæ–‡ä»¶æµ
```

### 6. å‰ç«¯ç•Œé¢è®¾è®¡

**åˆåŒç­¾ç½²é¡µé¢**ï¼š
```tsx
interface ContractSignPageProps {
    contractId: string;
    contractData: ContractData;
}

export default function ContractSignPage({ contractId, contractData }: ContractSignPageProps) {
    const [signature, setSignature] = useState<string>('');
    const [isSigning, setIsSigning] = useState(false);
    
    const handleSign = async () => {
        if (!signature) return;
        
        setIsSigning(true);
        try {
            const response = await fetch(`/api/contracts/${contractId}/sign`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    signatureData: signature,
                    signerType: 'CUSTOMER'
                })
            });
            
            const result = await response.json();
            if (result.success) {
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯ï¼Œæä¾›PDFä¸‹è½½é“¾æ¥
                toast.success('åˆåŒç­¾ç½²æˆåŠŸï¼');
            }
        } catch (error) {
            toast.error('ç­¾ç½²å¤±è´¥ï¼Œè¯·é‡è¯•');
        } finally {
            setIsSigning(false);
        }
    };
    
    return (
        <div className="contract-sign-page">
            <div className="contract-content">
                <div dangerouslySetInnerHTML={{ __html: contractData.content }} />
            </div>
            
            <div className="signature-section">
                <h3>è¯·åœ¨æ­¤å¤„ç­¾å</h3>
                <SignaturePad
                    onSignatureChange={setSignature}
                    width={400}
                    height={200}
                />
                <button 
                    onClick={handleSign}
                    disabled={!signature || isSigning}
                    className="sign-button"
                >
                    {isSigning ? 'ç­¾ç½²ä¸­...' : 'ç¡®è®¤ç­¾ç½²'}
                </button>
            </div>
        </div>
    );
}
```

### 7. å®‰å…¨æ–¹æ¡ˆ

**æ•°æ®å®‰å…¨**ï¼š
1. **HTTPSä¼ è¾“**ï¼šæ‰€æœ‰APIè¯·æ±‚ä½¿ç”¨HTTPS
2. **ç­¾åéªŒè¯**ï¼šä½¿ç”¨SHA-256å“ˆå¸ŒéªŒè¯ç­¾åå®Œæ•´æ€§
3. **æ—¶é—´æˆ³éªŒè¯**ï¼šé˜²æ­¢é‡æ”¾æ”»å‡»
4. **IPè®°å½•**ï¼šè®°å½•ç­¾ç½²æ—¶çš„IPåœ°å€

**åˆåŒå®‰å…¨**ï¼š
1. **æ•°å­—æ°´å°**ï¼šåœ¨PDFä¸­æ·»åŠ ä¸å¯è§æ°´å°
2. **å“ˆå¸ŒéªŒè¯**ï¼šåˆåŒå†…å®¹ç”Ÿæˆå“ˆå¸Œå€¼ï¼Œé˜²æ­¢ç¯¡æ”¹
3. **æ—¶é—´æˆ³**ï¼šè®°å½•ç­¾ç½²æ—¶é—´ï¼Œç¡®ä¿æ—¶æ•ˆæ€§
4. **å¤‡ä»½å­˜å‚¨**ï¼šåˆåŒPDFå¤‡ä»½åˆ°äº‘å­˜å‚¨

**è®¿é—®æ§åˆ¶**ï¼š
1. **ç­¾ç½²é“¾æ¥**ï¼šä½¿ç”¨ä¸€æ¬¡æ€§ç­¾ç½²é“¾æ¥ï¼ŒåŒ…å«è¿‡æœŸæ—¶é—´
2. **æƒé™éªŒè¯**ï¼šéªŒè¯ç”¨æˆ·èº«ä»½å’ŒåˆåŒå½’å±
3. **æ“ä½œæ—¥å¿—**ï¼šè®°å½•æ‰€æœ‰æ“ä½œæ—¥å¿—

## ğŸ’° æˆæœ¬åˆ†æ

### å¼€å‘æˆæœ¬
- **å¼€å‘æ—¶é—´**ï¼š2-3å‘¨
- **äººåŠ›æˆæœ¬**ï¼š1ä¸ªå…¨æ ˆå¼€å‘è€…

### è¿è¥æˆæœ¬
- **æœåŠ¡å™¨**ï¼š$10-20/æœˆï¼ˆPDFç”ŸæˆæœåŠ¡ï¼‰
- **å­˜å‚¨**ï¼š$5-10/æœˆï¼ˆåˆåŒPDFå­˜å‚¨ï¼‰
- **åŸŸåSSL**ï¼š$0ï¼ˆä½¿ç”¨ç°æœ‰åŸŸåï¼‰
- **æ€»è®¡**ï¼š$15-30/æœˆ

### ç¬¬ä¸‰æ–¹æœåŠ¡æˆæœ¬
- **æ— **ï¼šå®Œå…¨è‡ªå»ºï¼Œæ— ç¬¬ä¸‰æ–¹æœåŠ¡ä¾èµ–

## ğŸš€ å®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼ˆ1å‘¨ï¼‰ï¼šåŸºç¡€åŠŸèƒ½
1. æ•°æ®åº“è®¾è®¡å’Œåˆ›å»º
2. åˆåŒæ¨¡æ¿ç³»ç»Ÿ
3. åŸºç¡€APIæ¥å£

### ç¬¬äºŒé˜¶æ®µï¼ˆ1å‘¨ï¼‰ï¼šç­¾ç½²åŠŸèƒ½
1. ç”µå­ç­¾åç»„ä»¶
2. ç­¾ç½²API
3. å‰ç«¯ç­¾ç½²é¡µé¢

### ç¬¬ä¸‰é˜¶æ®µï¼ˆ1å‘¨ï¼‰ï¼šPDFç”Ÿæˆ
1. PDFç”ŸæˆæœåŠ¡
2. æ–‡ä»¶å­˜å‚¨
3. ä¸‹è½½åŠŸèƒ½

### ç¬¬å››é˜¶æ®µï¼ˆ0.5å‘¨ï¼‰ï¼šå®‰å…¨ä¼˜åŒ–
1. å®‰å…¨éªŒè¯
2. æ—¥å¿—è®°å½•
3. æµ‹è¯•å’Œä¼˜åŒ–

## ğŸ”§ æŠ€æœ¯æ ˆ

**åç«¯**ï¼š
- Next.js 14 API Routes
- Puppeteer (PDFç”Ÿæˆ)
- MySQL (æ•°æ®å­˜å‚¨)
- Node.js crypto (ç­¾åéªŒè¯)

**å‰ç«¯**ï¼š
- React 18
- Signature Pad (æ‰‹å†™ç­¾å)
- Tailwind CSS (æ ·å¼)

**éƒ¨ç½²**ï¼š
- Vercel/Netlify (å‰ç«¯)
- é˜¿é‡Œäº‘ECS (åç«¯æœåŠ¡)
- é˜¿é‡Œäº‘OSS (æ–‡ä»¶å­˜å‚¨)

## ğŸ“Š é¢„æœŸæ•ˆæœ

1. **è‡ªåŠ¨åŒ–ç¨‹åº¦**ï¼š90%ä»¥ä¸ŠåˆåŒè‡ªåŠ¨ç”Ÿæˆ
2. **ç­¾ç½²æ•ˆç‡**ï¼šä»3-5å¤©ç¼©çŸ­åˆ°å‡ åˆ†é’Ÿ
3. **æˆæœ¬èŠ‚çº¦**ï¼šç›¸æ¯”ä¼ ç»Ÿçº¸è´¨åˆåŒèŠ‚çº¦80%æˆæœ¬
4. **å®‰å…¨æ€§**ï¼šè¾¾åˆ°ç”µå­ç­¾åæ³•è¦æ±‚
5. **ç”¨æˆ·ä½“éªŒ**ï¼šç®€å•æ˜“ç”¨çš„ç­¾ç½²æµç¨‹

---

**æ–¹æ¡ˆä¼˜åŠ¿**ï¼š
- âœ… æˆæœ¬æä½ï¼ˆæœˆæˆæœ¬<$30ï¼‰
- âœ… å®‰å…¨å¯é ï¼ˆå¤šé‡éªŒè¯ï¼‰
- âœ… æ˜“äºç»´æŠ¤ï¼ˆçº¯è‡ªå»ºï¼‰
- âœ… æ‰©å±•æ€§å¼ºï¼ˆæ¨¡å—åŒ–è®¾è®¡ï¼‰
- âœ… ç¬¦åˆæ³•è§„ï¼ˆç”µå­ç­¾åæ³•ï¼‰
