# ä¼ä¸šå¾®ä¿¡å›è°ƒéªŒè¯é—®é¢˜æ’æŸ¥æŒ‡å—

## ğŸš¨ é—®é¢˜ç°è±¡
ä¼ä¸šå¾®ä¿¡åå°é…ç½®APIæ¥æ”¶æ¶ˆæ¯æ—¶ï¼ŒURLéªŒè¯å¤±è´¥ï¼Œæ˜¾ç¤º"è¯·æ±‚ä¸é€šè¿‡"æˆ–ç±»ä¼¼é”™è¯¯ã€‚

## ğŸ” é—®é¢˜æ’æŸ¥æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥URLé…ç½®
```
âœ… æ­£ç¡®æ ¼å¼ï¼šhttps://admin.xinghun.info/api/wecom/verify
âŒ é”™è¯¯æ ¼å¼ï¼šhttps://admin.xinghun.info/api/wecom/verify/
âŒ é”™è¯¯æ ¼å¼ï¼šhttp://admin.xinghun.info/api/wecom/verify
```

### ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥Tokené…ç½®
- ä¼ä¸šå¾®ä¿¡åå°ï¼š`L411dhQg`
- æœåŠ¡å™¨ç¯å¢ƒå˜é‡ï¼š`WECOM_TOKEN=L411dhQg`
- **ç¡®ä¿ä¸¤è€…å®Œå…¨ä¸€è‡´ï¼ŒåŒºåˆ†å¤§å°å†™**

### ç¬¬ä¸‰æ­¥ï¼šæ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
```bash
# æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦è¿è¡Œ
curl -I https://admin.xinghun.info/api/wecom/verify

# é¢„æœŸå“åº”ï¼š
# HTTP/1.1 400 Bad Request (ç¼ºå°‘å‚æ•°ï¼Œä½†è¯´æ˜æœåŠ¡æ­£å¸¸)
```

### ç¬¬å››æ­¥ï¼šä½¿ç”¨æµ‹è¯•å·¥å…·
```bash
# æµ‹è¯•éªŒè¯é€»è¾‘
curl -X POST "https://admin.xinghun.info/api/wecom/test-verify" \
  -H "Content-Type: application/json" \
  -d '{"baseUrl": "https://admin.xinghun.info/api/wecom/verify"}'
```

### ç¬¬äº”æ­¥ï¼šæŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—
```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
pm2 logs

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs --err
```

## ğŸ› ï¸ å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ

### é—®é¢˜1ï¼šTokenä¸åŒ¹é…
**ç°è±¡**ï¼šéªŒè¯å¤±è´¥ï¼Œç­¾åä¸æ­£ç¡®
**è§£å†³**ï¼š
1. ç¡®è®¤ä¼ä¸šå¾®ä¿¡åå°Tokenï¼š`L411dhQg`
2. æ£€æŸ¥æœåŠ¡å™¨ç¯å¢ƒå˜é‡ï¼š
   ```bash
   echo $WECOM_TOKEN
   ```
3. å¦‚éœ€ä¿®æ”¹ï¼Œé‡å¯æœåŠ¡ï¼š
   ```bash
   export WECOM_TOKEN=L411dhQg
   pm2 restart all
   ```

### é—®é¢˜2ï¼šURLæ— æ³•è®¿é—®
**ç°è±¡**ï¼šä¼ä¸šå¾®ä¿¡æ— æ³•è¿æ¥åˆ°URL
**è§£å†³**ï¼š
1. æ£€æŸ¥åŸŸåè§£æï¼š
   ```bash
   nslookup admin.xinghun.info
   ```
2. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
3. æ£€æŸ¥SSLè¯ä¹¦æ˜¯å¦æœ‰æ•ˆ

### é—®é¢˜3ï¼šæœåŠ¡å™¨æœªæ›´æ–°
**ç°è±¡**ï¼šä»£ç æ›´æ–°äº†ä½†éªŒè¯ä»å¤±è´¥
**è§£å†³**ï¼š
```bash
# ç¡®ä¿ä»£ç æ›´æ–°
git pull origin main

# é‡æ–°æ„å»º
npm run build

# é‡å¯æœåŠ¡
pm2 restart all
```

### é—®é¢˜4ï¼šç«¯å£æˆ–ä»£ç†é—®é¢˜
**ç°è±¡**ï¼šè¯·æ±‚è¢«ä»£ç†æœåŠ¡å™¨æ‹¦æˆª
**è§£å†³**ï¼š
1. æ£€æŸ¥Nginxé…ç½®
2. ç¡®ä¿APIè·¯å¾„æ­£ç¡®ä»£ç†åˆ°Next.jsåº”ç”¨
3. æ£€æŸ¥åå‘ä»£ç†è®¾ç½®

## ğŸ§ª æ‰‹åŠ¨éªŒè¯æ–¹æ³•

### æ–¹æ³•1ï¼šæ¨¡æ‹Ÿä¼ä¸šå¾®ä¿¡è¯·æ±‚
```bash
# ç”Ÿæˆæµ‹è¯•å‚æ•°
TOKEN="L411dhQg"
TIMESTAMP=$(date +%s)
NONCE="test123456"
ECHOSTR="test_echo_string"

# è®¡ç®—ç­¾åï¼ˆéœ€è¦æŒ‰å­—å…¸åºæ’åºï¼‰
# ä½¿ç”¨åœ¨çº¿SHA1è®¡ç®—å™¨æˆ–ç¼–ç¨‹è®¡ç®—

# å‘é€éªŒè¯è¯·æ±‚
curl "https://admin.xinghun.info/api/wecom/verify?msg_signature=YOUR_SIGNATURE&timestamp=$TIMESTAMP&nonce=$NONCE&echostr=$ECHOSTR"
```

### æ–¹æ³•2ï¼šä½¿ç”¨å†…ç½®æµ‹è¯•å·¥å…·
```bash
# è·å–æµ‹è¯•è¯´æ˜
curl https://admin.xinghun.info/api/wecom/test-verify

# æ‰§è¡Œè‡ªåŠ¨æµ‹è¯•
curl -X POST "https://admin.xinghun.info/api/wecom/test-verify" \
  -H "Content-Type: application/json" \
  -d '{"baseUrl": "https://admin.xinghun.info/api/wecom/verify"}'
```

## ğŸ“ ç´§æ€¥è§£å†³æ–¹æ¡ˆ

å¦‚æœä»¥ä¸Šæ–¹æ³•éƒ½æ— æ•ˆï¼Œå°è¯•è¿™äº›å¤‡ç”¨æ–¹æ¡ˆï¼š

### å¤‡ç”¨URL 1ï¼šä½¿ç”¨åŸå§‹æ¶ˆæ¯æ¥å£
```
URL: https://admin.xinghun.info/api/wecom/message
Token: L411dhQg
```

### å¤‡ç”¨URL 2ï¼šåˆ›å»ºç®€å•éªŒè¯é¡µé¢
```bash
# åˆ›å»ºæœ€ç®€å•çš„éªŒè¯æ¥å£
echo "<?php
if (\$_GET['echostr']) {
    echo \$_GET['echostr'];
}
?>" > verify.php

# ä¸Šä¼ åˆ°æœåŠ¡å™¨å¹¶æµ‹è¯•
```

### å¤‡ç”¨URL 3ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·
- ä½¿ç”¨ Webhook.site ç­‰å·¥å…·æŸ¥çœ‹ä¼ä¸šå¾®ä¿¡å‘é€çš„è¯·æ±‚
- åˆ†æè¯·æ±‚æ ¼å¼å’Œå‚æ•°

## ğŸ“Š éªŒè¯æˆåŠŸæ ‡å¿—

### ä¼ä¸šå¾®ä¿¡åå°æ˜¾ç¤ºï¼š
- âœ… URLéªŒè¯é€šè¿‡
- âœ… é…ç½®ä¿å­˜æˆåŠŸ  
- âœ… æ¶ˆæ¯æ¨é€çŠ¶æ€ï¼šå·²å¯ç”¨

### æœåŠ¡å™¨æ—¥å¿—æ˜¾ç¤ºï¼š
```
âœ“ ä¼ä¸šå¾®ä¿¡URLéªŒè¯æˆåŠŸ
=== è¿”å›echostr ===
```

### æµ‹è¯•å·¥å…·è¿”å›ï¼š
```json
{
  "success": true,
  "validation": {
    "isValid": true
  }
}
```

## ğŸ”„ å®Œæ•´é…ç½®æµç¨‹

1. **éƒ¨ç½²ä»£ç æ›´æ–°**
   ```bash
   git pull origin main
   npm run build
   pm2 restart all
   ```

2. **é…ç½®ç¯å¢ƒå˜é‡**
   ```bash
   export WECOM_TOKEN=L411dhQg
   ```

3. **æµ‹è¯•éªŒè¯æ¥å£**
   ```bash
   curl -X POST "https://admin.xinghun.info/api/wecom/test-verify" \
     -H "Content-Type: application/json" \
     -d '{"baseUrl": "https://admin.xinghun.info/api/wecom/verify"}'
   ```

4. **ä¼ä¸šå¾®ä¿¡åå°é…ç½®**
   - URL: `https://admin.xinghun.info/api/wecom/verify`
   - Token: `L411dhQg`
   - å‹¾é€‰"ç”¨æˆ·å‘é€çš„æ™®é€šæ¶ˆæ¯"

5. **ä¿å­˜å¹¶éªŒè¯**
   - ç‚¹å‡»ä¿å­˜
   - ç­‰å¾…éªŒè¯é€šè¿‡
   - å¯ç”¨æ¶ˆæ¯æ¨é€

---

**å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·æä¾›:**
1. ä¼ä¸šå¾®ä¿¡åå°çš„å…·ä½“é”™è¯¯ä¿¡æ¯
2. æœåŠ¡å™¨æ—¥å¿—å†…å®¹
3. æµ‹è¯•å·¥å…·çš„è¿”å›ç»“æœ

è¿™å°†å¸®åŠ©è¿›ä¸€æ­¥è¯Šæ–­é—®é¢˜ï¼ 